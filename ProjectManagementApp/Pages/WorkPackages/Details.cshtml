@page "{id:int}"
@model ProjectManagementApp.Pages.WorkPackages.DetailsModel
@{
    ViewData["Title"] = "Work Package Details";
}

<h2>Work Package Details</h2>

@if (Model.WorkPackage != null)
{
    <div class="card">
        <div class="card-body">
            <h3 class="card-title">@Model.WorkPackage.Name</h3>
            <p><strong>Description:</strong> @Model.WorkPackage.Description</p>
            <p><strong>Status:</strong> @Model.WorkPackage.Status</p>
            <p>
                <strong>Project:</strong>
                @if (Model.WorkPackage.Project != null)
                {
                    <a asp-page="/Projects/Details" asp-route-id="@Model.WorkPackage.Project.Id">
                        @Model.WorkPackage.Project.Name
                    </a>
                }
                else
                {
                    <span>N/A</span>
                }
            </p>

            <p>
                <strong>Team:</strong>
                @if (Model.WorkPackage.Team != null)
                {
                    <a asp-page="/Teams/Details" asp-route-id="@Model.WorkPackage.Team.Id">
                    @Model.WorkPackage.Team.Name
                    </a>
                }
                else
                {
                    <span>No team assigned.</span>
                }
            </p>
        </div>
    </div>

    <h4 class="mt-4">Tasks</h4>
    @if (Model.WorkPackage.Tasks != null && Model.WorkPackage.Tasks.Any())
    {
        <ul class="list-group mb-3">
            @foreach (var task in Model.WorkPackage.Tasks)
            {
                var taskPlanned = task.Activities?.Sum(a => a.PlannedHours) ?? 0;
                var taskActual = task.Activities?.Sum(a => a.ActualHours) ?? 0;

                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>@task.Name</strong> - @task.Description
                        <br />
                        Planned: @taskPlanned hrs,
                        Actual: @taskActual hrs
                    </div>
                    <div>
                        <a asp-page="/TaskItems/Details" asp-route-id="@task.Id" class="btn btn-sm btn-primary">View</a>
                    </div>
                </li>
            }
        </ul>
    }
    else
    {
        <p>No tasks available for this work package.</p>
    }

    <h4>Overall Progress</h4>
    <div class="progress mb-2">
        <div class="progress-bar" role="progressbar"
             style="width:@Model.ProgressPercent%;"
             aria-valuenow="@Model.ProgressPercent" aria-valuemin="0" aria-valuemax="100">
            @Model.ProgressPercent.ToString("0")%
        </div>
    </div>
    <p>Planned Hours: @Model.PlannedHours</p>
    <p>Actual Hours: @Model.ActualHours</p>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger mt-3">@TempData["ErrorMessage"]</div>
    }

    <div class="mt-3">
        <a asp-page="Index" class="btn btn-secondary">Back to List</a>
        <a asp-page="Edit" asp-route-id="@Model.WorkPackage.Id" class="btn btn-primary">Edit</a>
        <a asp-page="Delete" asp-route-id="@Model.WorkPackage.Id" class="btn btn-danger">Delete</a>
    </div>
}
else
{
    <p>Work Package not found.</p>
}
